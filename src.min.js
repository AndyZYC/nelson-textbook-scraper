// Nelson Textbook Scraper
// You acknowledge to use this at your own risk, contributors are not responsible for any consequences or legal repercussions
// It is your responsibility to abide by the laws of your country of residence when using this

// Run this in the console of your web browser

function makeHttpObject(){try{return new XMLHttpRequest()}catch(error){}
try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(error){}
try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(error){}
throw new Error("Could not create HTTP request object.")}
function pdf_exists(url){return new Promise(function(resolve){try{let request=makeHttpObject();request.open("GET",url,!0);request.send(null);request.onreadystatechange=function(){if(request.readyState==4)
if(request.responseText.includes("Error 404--Not Found"))
resolve(!1);else resolve(!0)}}catch(error){resolve(!1)}})}
function gen_url(base_url,unit,chapter_padding,chapter,section,ending){let chapter_str=String(chapter_padding);chapter_str=chapter_str.padStart(2,'0');let url=base_url;if(unit){url+="_u"+String(unit)}else{if(chapter_padding)
url+="_c"+chapter_str;if(chapter)
url+="_"+chapter;if(section)
url+="_"+section}
if(ending)
url+=ending;url+=".pdf";return url}
async function download_pdf(url,validate_url,file_name){if(validate_url&&!await pdf_exists(url))
return;console.log("Downloading "+url+" as "+file_name+".pdf")
let link=document.createElement('a');link.href=url;link.download=file_name+'.pdf';link.dispatchEvent(new MouseEvent('click'));await new Promise(resolve=>setTimeout(resolve,100))}
{const base_url=prompt("Enter the url of the textbook\nFrom the beginning to first _ at the end\nExample: http://k12resources.nelson.com/science/1234567890/student/documents/attachments/chem12");let chapter_padding=1;let chapter=1;let section=1;let unit;console.log("Beginning PDF download...")
await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_fm"),!0,"contents");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_discover"),!0,"discover");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_safescience"),!0,"safescience");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_toc"),!0,"table_of_contents");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_cp"),!0,"copyright");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_rap"),!0,"reviewers_and_advisory_panel");while(await pdf_exists(gen_url(base_url,undefined,chapter_padding,chapter,section))){console.log("Downloading chapter "+chapter+"...")
await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_open"),!0,chapter+"-open");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_op"),!0,chapter+"-opener");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_gs"),!0,chapter+"-getting_started");while(await pdf_exists(gen_url(base_url,undefined,chapter_padding,chapter,section))){await download_pdf(gen_url(base_url,undefined,chapter_padding,chapter,section),!1,chapter+"-"+section);section++}
await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_tech"),!0,chapter+"-tech_connect");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_awesome"),!0,chapter+"-awesome_science");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_works"),!0,chapter+"-science_works");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_lookingback"),!0,chapter+"-looking_back");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_inv"),!0,chapter+"-investigation");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_summary"),!0,chapter+"-summary");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_sq"),!0,chapter+"-self_quiz");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_review"),!0,chapter+"-review");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_sum"),!0,chapter+"-summary");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_r"),!0,chapter+"-review");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_cm"),!0,chapter+"-curious_math");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_mcr"),!0,chapter+"-mid_chapter_review");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_cr"),!0,chapter+"-chapter_review");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_cst"),!0,chapter+"-chapter_self_test");await download_pdf(gen_url(base_url,undefined,chapter_padding,undefined,undefined,"_ct"),!0,chapter+"-chapter_task");section=1;chapter_padding++;chapter++}
while(await pdf_exists(gen_url(base_url,undefined,undefined,chapter,section))){console.log("Downloading chapter "+chapter+"...")
await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_open"),!0,chapter+"-open");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_op"),!0,chapter+"-opener");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_gs"),!0,chapter+"-getting_started");while(await pdf_exists(gen_url(base_url,undefined,undefined,chapter,section))){await download_pdf(gen_url(base_url,undefined,undefined,chapter,section),!1,chapter+"-"+section);section++}
await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_tech"),!0,chapter+"-tech_connect");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_awesome"),!0,chapter+"-awesome_science");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_works"),!0,chapter+"-science_works");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_lookingback"),!0,chapter+"-looking_back");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_inv"),!0,chapter+"-investigation");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_summary"),!0,chapter+"-summary");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_sq"),!0,chapter+"-self_quiz");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_review"),!0,chapter+"-review");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_sum"),!0,chapter+"-summary");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_r"),!0,chapter+"-review");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_cm"),!0,chapter+"-curious_math");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_mcr"),!0,chapter+"-mid_chapter_review");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_cr"),!0,chapter+"-chapter_review");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_cst"),!0,chapter+"-chapter_self_test");await download_pdf(gen_url(base_url,undefined,undefined,chapter,undefined,"_ct"),!0,chapter+"-chapter_task");section=1;chapter++}
if(await pdf_exists(gen_url(base_url,"1",undefined,undefined,undefined,"_open"))||await pdf_exists(gen_url(base_url,"1",undefined,undefined,undefined,"open"))){unit=1}else if(await pdf_exists(gen_url(base_url,"a",undefined,undefined,undefined,"_open"))||await pdf_exists(gen_url(base_url,"a",undefined,undefined,undefined,"_open"))){unit="a"}
while(await pdf_exists(gen_url(base_url,unit,undefined,undefined,undefined,"_open"))||await pdf_exists(gen_url(base_url,unit,undefined,undefined,undefined,"open"))){console.log("Downloading unit "+unit+"...")
await download_pdf(gen_url(base_url,unit,undefined,undefined,undefined,"_open"),!1,"u-"+unit+"-open");await download_pdf(gen_url(base_url,unit,undefined,undefined,undefined,"open"),!1,"u-"+unit+"-open");await download_pdf(gen_url(base_url,unit,undefined,undefined,undefined,"_lookingback"),!0,"u-"+unit+"-looking_back");await download_pdf(gen_url(base_url,unit,undefined,undefined,undefined,"_ut"),!0,"u-"+unit+"-tasks");await download_pdf(gen_url(base_url,unit,undefined,undefined,undefined,"_sq"),!0,"u-"+unit+"-self_quiz");await download_pdf(gen_url(base_url,unit,undefined,undefined,undefined,"_review"),!0,"u-"+unit+"-review");await download_pdf(gen_url(base_url,unit,undefined,undefined,undefined,"lookingback"),!0,"u-"+unit+"-looking_back");await download_pdf(gen_url(base_url,unit,undefined,undefined,undefined,"t"),!0,"u-"+unit+"-tasks");await download_pdf(gen_url(base_url,unit,undefined,undefined,undefined,"sq"),!0,"u-"+unit+"-self_quiz");await download_pdf(gen_url(base_url,unit,undefined,undefined,undefined,"r"),!0,"u-"+unit+"-review");if(await pdf_exists(gen_url(base_url,"1",undefined,undefined,undefined,"_open"))||await pdf_exists(gen_url(base_url,"1",undefined,undefined,undefined,"open"))){unit++}else if(await pdf_exists(gen_url(base_url,"a",undefined,undefined,undefined,"_open"))||await pdf_exists(gen_url(base_url,"a",undefined,undefined,undefined,"open"))){unit=String.fromCharCode(unit.charCodeAt(0)+1)}}
let letter;let appendex_index=0;while(await pdf_exists(gen_url(base_url,undefined,undefined,undefined,undefined,"_app_"+(letter=String.fromCharCode(65+appendex_index).toLowerCase())))){await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_app_"+letter),!1,"appendix_"+letter);appendex_index++}
await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_periodictable"),!0,"periodic_table");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_answers"),!0,"answers");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_glossary"),!0,"glossary");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_index"),!0,"index");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_credits"),!0,"credits");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_gl"),!0,"glossary");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_ans"),!0,"answers");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_ind"),!0,"index");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_crd"),!0,"credits");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_cumr_1_3"),!0,"chapters_1_3_cumulative_review");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_cumr_4_6"),!0,"chapters_4_6_cumulative_review");await download_pdf(gen_url(base_url,undefined,undefined,undefined,undefined,"_cumr_7_8"),!0,"chapters_7_8_cumulative_review");console.log("---------- PDF download complete")}
